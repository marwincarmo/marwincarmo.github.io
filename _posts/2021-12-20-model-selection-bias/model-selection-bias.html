<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { color: #585cf6; } /* Constant */
code span.co { color: #4c886b; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.dv { color: #0000cd; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cd; } /* Float */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { color: #687687; } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #036a07; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
  <title>Simulating post selection inference</title>

  <meta property="description" itemprop="description" content="A short description of the post."/>

  <link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>

  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2021-12-20"/>
  <meta property="article:created" itemprop="dateCreated" content="2021-12-20"/>
  <meta name="article:author" content="Marwin Carmo"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Simulating post selection inference"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="A short description of the post."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Simulating post selection inference"/>
  <meta property="twitter:description" content="A short description of the post."/>

  <!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Statistical Inference After Model Selection;citation_publication_date=2010;citation_volume=26;citation_doi=10.1007/s10940-009-9077-7;citation_issn=1573-7799;citation_author=Richard Berk;citation_author=Lawrence Brown;citation_author=Linda Zhao"/>
  <meta name="citation_reference" content="citation_title=What you can and can’t properly do with regression;citation_publication_date=2010;citation_volume=26;citation_doi=10.1007/s10940-010-9116-4;citation_issn=1573-7799;citation_author=Richard Berk"/>
  <meta name="citation_reference" content="citation_title=Statistical methods for the social and behavioural sciences: A model-based approach;citation_publication_date=2017;citation_publisher=SAGE Publications;citation_author=D. B. Flora"/>
  <meta name="citation_reference" content="citation_title=Valid post-selection inference;citation_publication_date=2013;citation_publisher=Institute of Mathematical Statistics;citation_volume=41;citation_doi=10.1214/12-AOS1077;citation_issn=0090-5364, 2168-8966;citation_author=Richard Berk;citation_author=Lawrence Brown;citation_author=Andreas Buja;citation_author=Kai Zhang;citation_author=Linda Zhao"/>
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output","creative_commons","bibliography","csl","draft"]}},"value":[{"type":"character","attributes":{},"value":["Simulating post selection inference"]},{"type":"character","attributes":{},"value":["A short description of the post.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Marwin Carmo"]},{"type":"character","attributes":{},"value":["https://github.com/marwincarmo"]}]}]},{"type":"character","attributes":{},"value":["2021-12-20"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","code_folding","highlight","toc","toc_depth"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["rstudio"]},{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[2]}]}]},{"type":"character","attributes":{},"value":["CC BY"]},{"type":"character","attributes":{},"value":["references.bib"]},{"type":"character","attributes":{},"value":["apa.csl"]},{"type":"logical","attributes":{},"value":[true]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["apa.csl","model-selection-bias_files/anchor-4.2.2/anchor.min.js","model-selection-bias_files/bowser-1.9.3/bowser.min.js","model-selection-bias_files/distill-2.2.21/template.v2.js","model-selection-bias_files/figure-html5/fig3-1.png","model-selection-bias_files/figure-html5/fig4-1.png","model-selection-bias_files/figure-html5/plot-ex1-1.png","model-selection-bias_files/figure-html5/plot-ex1a-1.png","model-selection-bias_files/figure-html5/plot-ex1b-1.png","model-selection-bias_files/figure-html5/unnamed-chunk-1-1.png","model-selection-bias_files/figure-html5/unnamed-chunk-2-1.png","model-selection-bias_files/figure-html5/unnamed-chunk-3-1.png","model-selection-bias_files/figure-html5/unnamed-chunk-4-1.png","model-selection-bias_files/figure-html5/unnamed-chunk-5-1.png","model-selection-bias_files/figure-html5/unnamed-chunk-6-1.png","model-selection-bias_files/header-attrs-2.12/header-attrs.js","model-selection-bias_files/jquery-3.6.0/jquery-3.6.0.js","model-selection-bias_files/jquery-3.6.0/jquery-3.6.0.min.js","model-selection-bias_files/jquery-3.6.0/jquery-3.6.0.min.map","model-selection-bias_files/popper-2.6.0/popper.min.js","model-selection-bias_files/tippy-6.2.7/tippy-bundle.umd.min.js","model-selection-bias_files/tippy-6.2.7/tippy-light-border.css","model-selection-bias_files/tippy-6.2.7/tippy.css","model-selection-bias_files/tippy-6.2.7/tippy.umd.min.js","model-selection-bias_files/webcomponents-2.0.0/webcomponents.js","references.bib"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          return "<p>" + $('#ref-' + ref).html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="model-selection-bias_files/header-attrs-2.12/header-attrs.js"></script>
  <script src="model-selection-bias_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="model-selection-bias_files/popper-2.6.0/popper.min.js"></script>
  <link href="model-selection-bias_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="model-selection-bias_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="model-selection-bias_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="model-selection-bias_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="model-selection-bias_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="model-selection-bias_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="model-selection-bias_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Simulating post selection inference","description":"A short description of the post.","authors":[{"author":"Marwin Carmo","authorURL":"https://github.com/marwincarmo","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-12-20T00:00:00.000-03:00","citationText":"Carmo, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Simulating post selection inference</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>A short description of the post.</p></p>
</div>

<div class="d-byline">
  Marwin Carmo <a href="https://github.com/marwincarmo"
class="uri">https://github.com/marwincarmo</a> 
  
<br/>2021-12-20
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#what-is-model-selection">What is model selection</a></li>
<li><a href="#why-is-it-a-problem">Why is it a problem?</a>
<ul>
<li><a href="#a-first-example">A first example</a></li>
<li><a href="#noise">Noise</a></li>
</ul></li>
<li><a href="#illustration">Illustration</a></li>
<li><a href="#possible-solutions">Possible solutions</a>
<ul>
<li><a href="#framing-the-problem">Framing the problem</a></li>
<li><a href="#a-more-formal-treatment">A more formal treatment</a></li>
<li><a href="#underlying-mechanisms">Underlying mechanisms</a></li>
<li><a href="#simulations-of-model-selection">Simulations of
model-selection</a></li>
<li><a href="#potential-solutions">Potential solutions</a></li>
</ul></li>
<li><a href="#lukacs-2009">Lukacs (2009)</a>
<ul>
<li><a href="#model-averaging-vs-stepwise-selection">Model averaging vs
Stepwise selection</a></li>
</ul></li>
<li><a href="#berk-et-al.-2013">Berk et al. (2013)</a></li>
</ul>
</nav>
</div>
<h1 id="what-is-model-selection">What is model selection</h1>
<p>Much of the current research questions on the behavioral and social
sciences are investigated using statistical models <span
class="citation" data-cites="flora2017statistical">(<a
href="#ref-flora2017statistical" role="doc-biblioref">Flora,
2017</a>)</span>. Models are simplified translations of a reality to
mathematical expressions; it’s aim is express how the data were
generated. Regression based models are vastly employed on empirical
research and often used to estimate causal effects <span
class="citation" data-cites="berk2010">(<a href="#ref-berk2010"
role="doc-biblioref">Berk, 2010</a>)</span>. However, to perform causal
modeling, researchers must specify a “correct” model (i.e. an accurate
model of the data generating process) prior to data collection and use
the obtained data only to estimate regression coefficients (see <span
class="citation" data-cites="berk2010">Berk (<a href="#ref-berk2010"
role="doc-biblioref">2010</a>)</span> for a further discussion). In
practice, researchers usually have only a vague idea of the right model
to answer their research questions or even if such model can be
estimated. Often, what is framed as statistical inference or causal
modeling is in fact a descriptive analysis; what <span class="citation"
data-cites="berk2010">Berk (<a href="#ref-berk2010"
role="doc-biblioref">2010</a>)</span> name as <em>Level I Regression
Analysis</em>.</p>
<p>To determine which variables should be included in the model, a
common solution is to resort to variable selection algorithms. However,
whenever data driven variable selection procedures are employed,
classical inference guarantees are invalidated due to the model itself
becoming <a
href="https://en.wikipedia.org/wiki/Stochastic">stochastic</a>. It means
that if the model selection method evaluates the stochastic component of
the data, the model is also considered stochastic <span class="citation"
data-cites="berkValidPostselectionInference2013">(<a
href="#ref-berkValidPostselectionInference2013"
role="doc-biblioref">Berk et al., 2013</a>)</span>.</p>
<h1 id="why-is-it-a-problem">Why is it a problem?</h1>
<p>Variable selection procedures aren’t in themselves problematic. When
the correct model is unknown prior to data analysis and the
<em>same</em> dataset is used for variable selection, parameter
estimation and statistical inferences, the estimated results can be
highly biased. We add a new source of uncertainty when performing model
selection. The regression parameters depends not only on the realized
random sample but also on which model they are placed. Additionally, the
model selected isn’t the same across samples, so there is another source
of uncertainty to the estimates. <span class="citation"
data-cites="berkStatisticalInferenceModel2010">(<a
href="#ref-berkStatisticalInferenceModel2010" role="doc-biblioref">Berk
et al., 2010</a>)</span>.</p>
<p>To see why, let’s consider a well defined population with it’s
unknown parameter values. One source of uncertainty lies on the
randomness of the sample drawn. The “best” model found via variable
selection is sample specific and isn’t guarantee to be the correct model
(if we assume that one such model in fact exists). Suppose we repeat the
process of drawing a random sample and performing model selection
countless times. As shown below, even when the correct model (in this
example, <span class="math inline">\(\hat{M}_2\)</span>) is three times
more likely to be selected than the competing models, it will be chosen
more frequently but not at the majority of the time.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>models</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"M"</span>, <span class='fl'>1</span><span class='op'>:</span><span class='fl'>6</span><span class='op'>)</span>

<span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/enframe.html'>enframe</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span>
      <span class='va'>models</span>, <span class='fl'>10000</span>, replace <span class='op'>=</span> <span class='cn'>TRUE</span>, 
      prob <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>/</span><span class='fl'>9</span>,<span class='fl'>1</span><span class='op'>/</span><span class='fl'>3</span>,<span class='fl'>1</span><span class='op'>/</span><span class='fl'>9</span>,<span class='fl'>1</span><span class='op'>/</span><span class='fl'>9</span>,<span class='fl'>1</span><span class='op'>/</span><span class='fl'>9</span>,<span class='fl'>1</span><span class='op'>/</span><span class='fl'>9</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>10000</span>,
  name <span class='op'>=</span> <span class='st'>"Model"</span>, value <span class='op'>=</span> <span class='st'>"Frequency"</span><span class='op'>)</span> |&gt; 
  <span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">M1</td>
<td style="text-align: right;">0.1235</td>
</tr>
<tr class="even">
<td style="text-align: left;">M2</td>
<td style="text-align: right;">0.3900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">M3</td>
<td style="text-align: right;">0.1185</td>
</tr>
<tr class="even">
<td style="text-align: left;">M4</td>
<td style="text-align: right;">0.1203</td>
</tr>
<tr class="odd">
<td style="text-align: left;">M5</td>
<td style="text-align: right;">0.1245</td>
</tr>
<tr class="even">
<td style="text-align: left;">M6</td>
<td style="text-align: right;">0.1232</td>
</tr>
</tbody>
</table>
</div>
<p>To understand how the regression parameters estimates might be biased
recall that in a multiple regression we estimate <em>partial regression
coefficients</em>: in a regression equation, the weight of independent
variables are estimated <strong>in relation to</strong> the other
independent variables in the model <span class="citation"
data-cites="cohen1983">(<a href="#ref-cohen1983"
role="doc-biblioref">Cohen &amp; Cohen, 1983</a>)</span>. For a
dependent variable, <span class="math inline">\(Y\)</span>, predicted by
variables <span class="math inline">\(X_1\)</span> and <span
class="math inline">\(X_2\)</span>, <span class="math inline">\(B_{Y1
\cdot 2}\)</span> is the partial regression coefficient for <span
class="math inline">\(Y\)</span> on <span
class="math inline">\(X_1\)</span> hodling <span
class="math inline">\(X_2\)</span> constant, and <span
class="math inline">\(B_{Y2 \cdot 1}\)</span> is the partial regression
coefficient for <span class="math inline">\(Y\)</span> on <span
class="math inline">\(X_2\)</span> hodling <span
class="math inline">\(X_1\)</span> constant. The regression equation is
written as:</p>
<p><span class="math display" id="eq:multreg">\[\begin{equation}
\hat{Y} = B_{Y0 \cdot 12} + B_{Y1 \cdot 2}X_1 + B_{Y2 \cdot 1}X_2 +
\varepsilon
\tag{1}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(B_{Y0 \cdot 12}\)</span> is the
model intercept when <span class="math inline">\(X_1\)</span> and <span
class="math inline">\(X_2\)</span> are held constant and <span
class="math inline">\(\varepsilon\)</span> is the error term.</p>
<p>To see how the regression coefficient for <span
class="math inline">\(X_i\)</span> is model dependent, let’s take a look
at the equations for the regression coefficients for <span
class="math inline">\(X_1\)</span> and <span
class="math inline">\(X_2\)</span></p>
<p><span class="math display" id="eq:beta12">\[\begin{equation}
B_{Y1 \cdot 2} = \frac{\rho_{Y1} - \rho_{Y2}\rho_{12}}{(1 -
\rho_{12}^2)} \times \frac{\sigma_Y}{\sigma_1}
\tag{2}
\end{equation}\]</span></p>
<p><span class="math display" id="eq:beta21">\[\begin{equation}
B_{Y2 \cdot 1} = \frac{\rho_{Y2} - \rho_{Y1}\rho_{21}}{(1 -
\rho_{21}^2)} \times \frac{\sigma_Y}{\sigma_2}
\tag{3}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\rho\)</span> stands for the
populational correlation coefficient and <span
class="math inline">\(\sigma\)</span> for the populational standard
deviation. It then becomes clear that, unless we have uncorrelated
predictors (i.e. <span class="math inline">\(\rho_{12}\)</span> = <span
class="math inline">\(\rho_{21}\)</span> = 0), the value for any of the
regression coefficients is determined by the presence of other
predictors in the model. If either one is excluded from the model, a
different regression coefficient will be estimated (i.e. <span
class="math inline">\(B_{Y1}\)</span> or <span
class="math inline">\(B_{Y2}\)</span>).</p>
<p>It’s easier to see now that “model selection intervenes between the
realized sample and estimates of the regression parameters” <span
class="citation" data-cites="berkStatisticalInferenceModel2010">(<a
href="#ref-berkStatisticalInferenceModel2010" role="doc-biblioref">Berk
et al., 2010, p. 222</a>)</span>. <span class="citation"
data-cites="berkStatisticalInferenceModel2010">Berk et al. (<a
href="#ref-berkStatisticalInferenceModel2010"
role="doc-biblioref">2010</a>)</span> warns that the sampling
distribution of the estimated regression parameters is distorted because
estimates made from incorrect models will also be included, resulting in
a mixture of distributions. Therefore the model selection process must
be taken into account in the regression estimation.</p>
<h2 id="a-first-example">A first example</h2>
<p>To illustrate what we’ve just seen, let’s expand an analytic example
given by <span class="citation"
data-cites="berkStatisticalInferenceModel2010">Berk et al. (<a
href="#ref-berkStatisticalInferenceModel2010"
role="doc-biblioref">2010</a>)</span> with simulations: Consider a model
for a response variable <span class="math inline">\(y\)</span> with two
potential regressors, <span class="math inline">\(x\)</span> and <span
class="math inline">\(z\)</span>. Say we’re interest in the relationship
between <span class="math inline">\(y\)</span> and <span
class="math inline">\(x\)</span> while holding <span
class="math inline">\(z\)</span> constant. We’ll run a linear regression
model with the corresponding population regression coefficient of <span
class="math inline">\(\beta_{yx\cdot z}\)</span>.</p>
<p><span class="math display" id="eq:m1">\[\begin{equation}
y_i = \beta_0 + \beta_1x_i + \beta_2z_i + \varepsilon_i
\tag{4}
\end{equation}\]</span></p>
<p>Now, suppose that we’re in a scenario, where <span
class="math inline">\(\rho_{xz}\)</span> = 0.5, both <span
class="math inline">\(\beta_1\)</span> and <span
class="math inline">\(\beta_2\)</span> are set to 1 and <span
class="math inline">\(\varepsilon \sim N(0, 10)\)</span>. We’ll use a
sample size of 250 subjects and 1000 random samples will be drawn from
this population. We’ll calculate coverage and bias for each regressor.
<em>Coverage</em> corresponds to the frequency in which the true
coefficient value is captured by the 95% CI of the estimate. The
<em>bias</em> of the estimations is calculated as <span
class="math inline">\(\frac{1}{R}\sum(\hat{\theta_r}-\theta)\)</span>,
where <span class="math inline">\(R\)</span> is the number of
repetitions, <span class="math inline">\(\theta\)</span> represents a
population parameter, and <span
class="math inline">\(\hat{\theta}_r\)</span> a sample estimate.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fl'>2</span> <span class='co'># number of predictors</span>
<span class='va'>Sigma</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>.5</span>, <span class='va'>p</span>, <span class='va'>p</span><span class='op'>)</span> <span class='co'># correlation matrix</span>
<span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span><span class='op'>(</span><span class='va'>Sigma</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='va'>n</span> <span class='op'>=</span> <span class='fl'>250</span> <span class='co'># sample size</span>
<span class='va'>b0</span> <span class='op'>&lt;-</span> <span class='fl'>10</span> <span class='co'># intercept (can be set to any value)</span>
<span class='va'>betas</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span> 
<span class='va'>reps</span> <span class='op'>=</span> <span class='fl'>1000</span>
<span class='va'>coefs</span> <span class='op'>&lt;-</span> <span class='va'>cover</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>0</span>, nrow <span class='op'>=</span> <span class='va'>reps</span>, ncol <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='co'># defining the matrices to store simulation results</span>


<span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='va'>reps</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'># X is a matrix of regression coefficients</span>
  <span class='va'>X</span> <span class='op'>&lt;-</span>  <span class='fu'>MASS</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/MASS/man/mvrnorm.html'>mvrnorm</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='va'>n</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>2</span><span class='op'>)</span> , <span class='va'>Sigma</span><span class='op'>)</span>
  <span class='co'># with the values randomly drawn in X, we'll estimate values for y</span>
  <span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='va'>X</span><span class='op'>)</span> <span class='op'><a href='https://rdrr.io/r/base/matmult.html'>%*%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>b0</span>, <span class='va'>betas</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span>, <span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>Xy</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>X</span>, <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>Xy</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"x"</span>, <span class='st'>"z"</span><span class='op'>)</span>, <span class='st'>"y"</span><span class='op'>)</span>
  <span class='co'># fit a linear model with x and z to predict y</span>
  <span class='va'>fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>Xy</span><span class='op'>)</span>
  <span class='va'>coefs</span><span class='op'>[</span><span class='va'>i</span>, <span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span><span class='op'>[</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>]</span>
  <span class='va'>cis</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/confint.html'>confint</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span><span class='op'>[</span><span class='op'>-</span><span class='fl'>1</span>,<span class='op'>]</span>
  <span class='co'># in this matrix we called "cover" </span>
  <span class='va'>cover</span><span class='op'>[</span><span class='va'>i</span>,<span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>cis</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>1</span> <span class='op'>&amp;</span> <span class='va'>cis</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span> <span class='op'>&gt;</span> <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>0</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>coefs</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"x"</span>, <span class='st'>"z"</span><span class='op'>)</span>
<span class='va'>coefs</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='va'>coefs</span><span class='op'>)</span>

<span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>
  Predictor <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"x"</span>, <span class='st'>"z"</span><span class='op'>)</span>,
  Coverage <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colMeans</a></span><span class='op'>(</span><span class='va'>cover</span><span class='op'>)</span>,
  Bias <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colMeans</a></span><span class='op'>(</span><span class='va'>coefs</span> <span class='op'>-</span> <span class='va'>betas</span><span class='op'>)</span>
<span class='op'>)</span> |&gt; 
  <span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Predictor</th>
<th style="text-align: right;">Coverage</th>
<th style="text-align: right;">Bias</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">x</td>
<td style="text-align: right;">0.953</td>
<td style="text-align: right;">0.0088806</td>
</tr>
<tr class="even">
<td style="text-align: left;">z</td>
<td style="text-align: right;">0.949</td>
<td style="text-align: right;">-0.0071937</td>
</tr>
</tbody>
</table>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>coefs</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_histogram.html'>geom_histogram</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"black"</span>, fill <span class='op'>=</span> <span class='st'>"white"</span>, bins <span class='op'>=</span> <span class='fl'>30</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.title.y<span class='op'>=</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
        axis.text.y<span class='op'>=</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>, 
        axis.ticks.y<span class='op'>=</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
        axis.line.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>xlab</a></span><span class='op'>(</span> <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"Values of "</span>, <span class='va'>beta</span><span class='op'>[</span><span class='va'>yx.z</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="model-selection-bias_files/figure-html5/plot-ex1a-1.png" width="624" /></p>
</div>
<p>In this first scenario <span class="math inline">\(\beta_{yx\cdot
z}\)</span> is estimated assuming <span class="math inline">\(x\)</span>
and <span class="math inline">\(z\)</span> are always included in the
model.</p>
<p>What would happen if by model selection we arrive at a model where
<span class="math inline">\(z\)</span> is excluded? If <span
class="math inline">\(z\)</span> is excluded, any correlation where
<span class="math inline">\(z\)</span> is involved is equivalent to
zero, and we’re left with,</p>
<p><span class="math display" id="eq:ex11">\[\begin{equation}
\beta_{yx} = \rho_{xy}(\frac{\sigma_y}{\sigma_x})
\tag{5}
\end{equation}\]</span></p>
<p>Note that <span class="math inline">\(\beta_{yx}\)</span> is not the
same as <span class="math inline">\(\beta_{yx\cdot z}\)</span>. If we do
not have a model specified prior to data collection and analysis, it is
not clear which definition of regression parameter for <span
class="math inline">\(x\)</span> we’re trying to estimate, if <span
class="math inline">\(\beta_{yx\cdot z}\)</span>, as exemplified on
equation <a href="#eq:beta12">(2)</a> or if <span
class="math inline">\(\beta_{yx}\)</span>. Therefore, the definition of
<span class="math inline">\(x\)</span> depends on the model in which it
is placed.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fl'>2</span>
<span class='va'>Sigma</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>.5</span>, <span class='va'>p</span>, <span class='va'>p</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span><span class='op'>(</span><span class='va'>Sigma</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='va'>n</span> <span class='op'>=</span> <span class='fl'>250</span>
<span class='va'>b0</span> <span class='op'>&lt;-</span> <span class='fl'>10</span>
<span class='va'>betas</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span>
<span class='va'>reps</span> <span class='op'>=</span> <span class='fl'>1000</span>
<span class='va'>coefs</span> <span class='op'>&lt;-</span> <span class='va'>cover</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='cn'>NA</span>, nrow <span class='op'>=</span> <span class='va'>reps</span>, ncol <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='va'>reps</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'>#print(i)</span>
  <span class='va'>X</span> <span class='op'>&lt;-</span>  <span class='fu'>MASS</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/MASS/man/mvrnorm.html'>mvrnorm</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='va'>n</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>2</span><span class='op'>)</span> , <span class='va'>Sigma</span><span class='op'>)</span>
  <span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='va'>X</span><span class='op'>)</span> <span class='op'><a href='https://rdrr.io/r/base/matmult.html'>%*%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>b0</span>, <span class='va'>betas</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span>, <span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>Xy</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>X</span>, <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>Xy</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"x"</span>, <span class='st'>"z"</span><span class='op'>)</span>, <span class='st'>"y"</span><span class='op'>)</span>
  <span class='va'>fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='va'>x</span>, data <span class='op'>=</span> <span class='va'>Xy</span><span class='op'>)</span>
  <span class='va'>coefs</span><span class='op'>[</span><span class='va'>i</span>, <span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span><span class='op'>[</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>]</span>
  <span class='va'>cis</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/confint.html'>confint</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span><span class='op'>[</span><span class='op'>-</span><span class='fl'>1</span>,<span class='op'>]</span>
  <span class='va'>cover</span><span class='op'>[</span><span class='va'>i</span>,<span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>cis</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>1</span> <span class='op'>&amp;</span> <span class='va'>cis</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='op'>&gt;</span> <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>0</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>coefs</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"x"</span>, <span class='st'>"z"</span><span class='op'>)</span>
<span class='va'>coefs</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='va'>coefs</span><span class='op'>)</span>
<span class='co'># coverage</span>
<span class='va'>cover1b</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colMeans</a></span><span class='op'>(</span><span class='va'>cover</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>
<span class='co'># bias</span>
<span class='va'>bias1b</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colMeans</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>coefs</span> <span class='op'>-</span> <span class='va'>betas</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>coefs</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_histogram.html'>geom_histogram</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"black"</span>, fill <span class='op'>=</span> <span class='st'>"white"</span>, bins <span class='op'>=</span> <span class='fl'>30</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.title.y<span class='op'>=</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
        axis.text.y<span class='op'>=</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>, 
        axis.ticks.y<span class='op'>=</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
        axis.line.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>xlab</a></span><span class='op'>(</span> <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"Values of "</span>, <span class='va'>beta</span><span class='op'>[</span><span class='va'>yx</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="model-selection-bias_files/figure-html5/plot-ex1b-1.png" width="624" /></p>
</div>
<p>Notice how far off the latter model estimates the coefficient for
<span class="math inline">\(x\)</span>. Under these conditions, we
should expect a coverage of the true coefficient value of <span
class="math inline">\(x\)</span> of 0.33 and a bias of 0.289. Under the
correct model, bias is negligible and coverage follows the Type I error
rate of 5% that we’ve set for this exercise.</p>
<p>This simple example help us understand why estimate model parameters
in the same single random sample used to find an appropriate model isn’t
a good idea (at least not without taking this process in account prior
to making inferences). Discarding <span class="math inline">\(z\)</span>
from our model has distorted the sampling distribution of <span
class="math inline">\(x\)</span>. Thus, as <span class="citation"
data-cites="berkStatisticalInferenceModel2010">Berk et al. (<a
href="#ref-berkStatisticalInferenceModel2010"
role="doc-biblioref">2010</a>)</span> puts it: “when a single model is
not specified before the analysis begins, it is not clear what
population parameter is the subject of study. And without this clarity,
the reasoning behind statistical inference becomes obscure”.</p>
<p>Now is a good time to pause and ponder. We already know that if two
predictors are moderately correlated and one is dropped from the model,
our estimation will be biased. But what else should we consider? If you
are selecting the variable every time, then there is not issue. In the
following sections we’ll consider what can make things “bad”. But before
that, please consider the equation for the standard error of the
regression coefficient estimated in our first example that hasn’t gone
through model selection,</p>
<p><span class="math display" id="eq:sebxy">\[\begin{equation}
SE(\beta_{yx\cdot z}) = \frac{\hat{\sigma_{\varepsilon}}}{s_x
\sqrt{n-1}}\sqrt{\frac{1}{1-r^2_{xy}}}
\tag{6}
\end{equation}\]</span></p>
<p>We’ll use simulated data to aid our understanding. I have build a <a
href="https://marwin.shinyapps.io/model-selection-app/">ShinyApp</a> for
that end. Its purpose is to illustrate the problems that arise when
model selection, parameters estimation and statistical inferences are
undertaken with the same data set. Although I will be working with code
in this post, everything can also be reproduced via this app.</p>
<p>simular com um range de valores para cada elemento que traz
problema</p>
<h2 id="noise">Noise</h2>
<p>To express the variability we can use the “signal-to-noise” ratio
(SNR). This term is defined as:</p>
<p><span class="math display">\[\frac{S}{N} =
\textbf{b}\Sigma\textbf{b}\sigma^{-2}\]</span> where, <span
class="math inline">\(\textbf{b}\)</span> is a (<em>p</em> + 1) <span
class="math inline">\(\times\)</span> 1 vector of regression
coefficients, <span class="math inline">\(\Sigma\)</span> is the
covariance matrix of predictors and <span
class="math inline">\(\sigma^2\)</span> is the error term variance.</p>
<ul>
<li>SNR</li>
<li>Sample size</li>
<li>predictors</li>
<li>BIC/AIC</li>
<li>correlacao</li>
</ul>
<p>Now there is a good opportunity for a simulation exercise. To
illustrate what we have been talking so far, <span class="citation"
data-cites="berkStatisticalInferenceModel2010">Berk et al. (<a
href="#ref-berkStatisticalInferenceModel2010"
role="doc-biblioref">2010</a>)</span> proposes the following
example:</p>
<p>Consider two candidate regression models <span
class="math inline">\(M_1\)</span> and <span
class="math inline">\(M_2\)</span>. Define <span
class="math inline">\(M_1\)</span> to be</p>
<p><span class="math display" id="eq:m11">\[\begin{equation}
y_i = \beta_0 + \beta_1x_i + \beta_2z_i + \varepsilon_i
\tag{7}
\end{equation}\]</span></p>
<p>and <span class="math inline">\(M_2\)</span> to be</p>
<p><span class="math display" id="eq:m2">\[\begin{equation}
y_i = \beta_0 + \beta_1x_i + \varepsilon_i
\tag{8}
\end{equation}\]</span></p>
<p>Because in <span class="math inline">\(M_2\)</span> <span
class="math inline">\(z_i\)</span> is absent,</p>
<h1 id="illustration">Illustration</h1>
<p>Exemplificar com simulação (passos utilizados no app)</p>
<h1 id="possible-solutions">Possible solutions</h1>
<p>Soluções (berk 2010 e buscar mais) # Berk (2010)</p>
<p>Statistical inference assumes that a correct model exists and it is
known except for parameter values before data analysis. This correct
model is an accurate representation of the data generating process.
Therefore, arriving at different models with model selection is
problematic.</p>
<h2 id="framing-the-problem">Framing the problem</h2>
<p>When the correct model is unknown prior to data analysis, four steps
are usually taken:</p>
<ol type="1">
<li>Construct a set of models<br />
</li>
<li>Examine the data and select a “final” model<br />
</li>
<li>Estimate model parameters<br />
</li>
<li>Perform statistical inferences to parameter estimates</li>
</ol>
<p>These steps are not problematic in themselves. What can cause
problems is that the selection rule is dependent on the regression
parameters.</p>
<p>Model selection undertaken via nested testing produces the same
difficulties as when it is done by data exploration.</p>
<h2 id="a-more-formal-treatment">A more formal treatment</h2>
<p>With different models, the object of estimation assumes different
definitions. Without a model it is not possible to define what’s been
estimated.</p>
<p>For a response variable <span class="math inline">\(Y\)</span>, say
we have two regressors <span class="math inline">\(X\)</span> and <span
class="math inline">\(Z\)</span>. To estimate the relationship between
<span class="math inline">\(Y\)</span> and <span
class="math inline">\(X\)</span> holding <span
class="math inline">\(Z\)</span> constant we use the following linear
regression model:</p>
<p><span class="math display">\[
\beta_{yx.z} = \frac{\rho_{xy}-\rho_{xz}\rho_{yz}}{(1-\rho^2_{xz})}
\times \frac{\sigma_y}{\sigma_x}
\]</span> If <span class="math inline">\(Z\)</span> is not present in
the model, the correlations involving this predictor are equivalent to
zero, and <span class="math inline">\(\beta_{yx} =
\rho_{yx}(\sigma_y/\sigma_x)\)</span>. This is a different estimate from
<span class="math inline">\(\beta_{yx.z}\)</span>. This example
illustrates how a regression parameter depends on the model in which it
is placed. Without a clear model pre-defined prior the analysis, the
population parameter under study is unclear.</p>
<p>If the model is defined through model selection and the parameter
estimated from a different random sample, it poses no problem to the
analysis. However, usually this process is carried on the same random
sample, and there is were things go south.</p>
<p>We add a new source of uncertainty when performing model selection.
As we just saw, the regression parameter depends not only on the
realized random sample but also on which model they are placed.
Additionally, the model selected isn’t the same across samples, so there
is another uncertainty to the estimates.</p>
<p>In a population, we have a theoretical infinite number of possible
random samples. If a correct model exists, we expect that it will be
represented by the realized sample more frequently than their
competitors. This illustrates how the model selection procedure is
sample dependent. In this way, it is an estimate of the correct
model.</p>
<p>Note that I’ve said that the random sample process chooses the
correct model <em>more frequently than</em> than the competitors. It
doesn’t mean that this model is chosen at the majority of the time
(Think about 6 models realized in 9 random samples. say that the correct
model is chosen 3 times and all the others no more than 2. Even though
it is chosen with a greater frequency than the others, if we take a
random sample from these 9 models we are more likely to draw an
incorrect model).</p>
<p>Summarizing:</p>
<ul>
<li><p>The estimated regression parameter depends on the model selected
and the realized sample</p></li>
<li><p>Its sampling distribution may be composed from estimates made
from correct and incorrect models</p></li>
<li><p>The model selection process must be taken into account in the
regression estimation</p></li>
</ul>
<h3 id="simulating-figure-2">Simulating figure 2</h3>
<p>The mean squared errors for both regression models are assumed to be
approximately 1.0. Then, the sampling distribution for <span
class="math inline">\(\beta_1\)</span>, conditional on <span
class="math inline">\(M_1\)</span> being selected, is taken to be normal
with a mean of 12.0 and a standard deviation of 2.0. The sampling
distribution for b1, conditional on <span
class="math inline">\(M_2\)</span> being selected, is taken to be normal
with a mean of 4.0 and a standard deviation of 1. To minimize the
complications, an ancilliary selection procedure is applied such that
<span class="math inline">\(P(\hat{M_1}) = .2\)</span> and <span
class="math inline">\(P(\hat{M_2}) = .8\)</span>; the model selection
procedure chooses <span class="math inline">\(M_2\)</span> four times
more often than <span class="math inline">\(M_1\)</span>. Figure 2 is
constructed by making 10,000 draws from the first normal distribution
and 40,000 draws from the second normal distribution.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>b1.m1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>10000</span>, mean <span class='op'>=</span> <span class='fl'>12</span>, sd <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='va'>b1.m2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>40000</span>, mean <span class='op'>=</span> <span class='fl'>4</span>, sd <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>

<span class='va'>combined_dist</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
  model <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"m1"</span>, <span class='fl'>10000</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"m2"</span>, <span class='fl'>40000</span><span class='op'>)</span><span class='op'>)</span>,
  b1 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>b1.m1</span>, <span class='va'>b1.m2</span><span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<p>The combined distribution has a mean of approximately 5.6 and a
standard deviation of approximately 3.4.</p>
<p>We don’t know which model is correct. Either way, the estimate will
be far from its true value and its standard error, larger.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>fig2</span> <span class='op'>&lt;-</span> <span class='va'>combined_dist</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>b1</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_histogram.html'>geom_histogram</a></span><span class='op'>(</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y<span class='op'>=</span><span class='va'>..density..</span><span class='op'>)</span>, color<span class='op'>=</span><span class='st'>"#e9ecef"</span>, alpha<span class='op'>=</span><span class='fl'>0.6</span>, position <span class='op'>=</span> <span class='st'>'identity'</span>, bins <span class='op'>=</span> <span class='fl'>80</span>, fill <span class='op'>=</span> <span class='st'>"#69b3a2"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_density.html'>geom_density</a></span><span class='op'>(</span>alpha<span class='op'>=</span><span class='fl'>.2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_function.html'>stat_function</a></span><span class='op'>(</span>fun <span class='op'>=</span> <span class='va'>dnorm</span>, args <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>mean <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>combined_dist</span><span class='op'>$</span><span class='va'>b1</span><span class='op'>)</span><span class='op'>)</span>,
                                   sd <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>combined_dist</span><span class='op'>$</span><span class='va'>b1</span><span class='op'>)</span><span class='op'>)</span>,
                col <span class='op'>=</span> <span class='st'>"red"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>xlab</a></span><span class='op'>(</span><span class='st'>"Regression Coefficient Values"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>"Density"</span><span class='op'>)</span>
<span class='va'>fig2</span>
</code></pre>
</div>
</details>
<p><img src="model-selection-bias_files/figure-html5/unnamed-chunk-1-1.png" width="624" /></p>
</div>
<p>The estimation process is biased before statistical tests are
performed.</p>
<h2 id="underlying-mechanisms">Underlying mechanisms</h2>
<p>In model selection regressors with coefficients close to zero are
dropped from the model. This may create gaps near the 0.0 region on the
x-axis.</p>
<p>A regressors excluded from a model affects the performance of others
that remained. Recall from Eq. 1, where if <span
class="math inline">\(Z\)</span> is dropped from the model, we are no
longer estimating <span class="math inline">\(\beta_{yx.z}\)</span>, but
a bivariate correlation beween <span class="math inline">\(Y\)</span>
and <span class="math inline">\(X\)</span> and the ratio of their two
standard deviations.</p>
<p>When <span class="math inline">\(r_{yz}\)</span> and <span
class="math inline">\(r_{xz}\)</span> are large, the value of <span
class="math inline">\(\beta_{yx.z}\)</span> can change a great deal when
<span class="math inline">\(Z\)</span> is dropped.</p>
<p>Due to correlations between predictors, the sampling distribution
variance can also be affected by model selection (colocar no app essa
parte falando do SE, pag 225 do artigo).</p>
<h2 id="simulations-of-model-selection">Simulations of
model-selection</h2>
<p>Even when the preferred model is selected there is no guarantee about
gettind sound regression coefficient estimates.</p>
<p>For an initial simulation, selection is implemented through forward
stepwise regression using the AIC as a fit criterion. At each step, the
term is added that leads to the model with the smallest AIC. The
procedure stops when no remaining regressor improves the AIC.</p>
<p>For this simulation, the full regression model takes the form of</p>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1w_i + \beta_2x_i + \beta_3z_i + \varepsilon_i
\]</span></p>
<p>where <span class="math inline">\(\beta_0\)</span> = 3.0, <span
class="math inline">\(\beta_1\)</span> = 0.0, <span
class="math inline">\(\beta_2\)</span> = 1.0, and <span
class="math inline">\(\beta_3\)</span> = 2.0. The variances and
covariance are set as follows: <span
class="math inline">\(\sigma^2_\varepsilon\)</span> = 10.0, <span
class="math inline">\(\sigma^2_w\)</span> = 5.0, <span
class="math inline">\(\sigma^2_x\)</span> = 6.0, <span
class="math inline">\(\sigma^2_z\)</span> = 7.0, <span
class="math inline">\(\sigma_{w,x}\)</span> = 4.0, <span
class="math inline">\(\sigma_{w,z}\)</span> = 5.0, and <span
class="math inline">\(\sigma_{x,z}\)</span> = 5.0. The sample size is
200.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>reps</span> <span class='op'>=</span> <span class='fl'>100</span>
<span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fl'>3</span>
<span class='va'>Sigma</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>5</span>,<span class='fl'>4</span>,<span class='fl'>5</span>,
                  <span class='fl'>4</span>,<span class='fl'>6</span>,<span class='fl'>5</span>, 
                  <span class='fl'>5</span>,<span class='fl'>5</span>,<span class='fl'>7</span><span class='op'>)</span>, <span class='va'>p</span>, <span class='va'>p</span><span class='op'>)</span>
<span class='va'>n</span> <span class='op'>=</span> <span class='fl'>200</span>
<span class='va'>betas</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span>
<span class='va'>rsq</span> <span class='op'>&lt;-</span> <span class='cn'>NULL</span>
<span class='va'>coefs</span> <span class='op'>&lt;-</span> <span class='va'>cover</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='cn'>NA</span>, nrow <span class='op'>=</span> <span class='va'>reps</span>, ncol <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>coefs</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"w"</span>, <span class='st'>"x"</span>, <span class='st'>"z"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>cover</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"w"</span>, <span class='st'>"x"</span>, <span class='st'>"z"</span><span class='op'>)</span>

<span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='va'>reps</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'>#print(i)</span>
  <span class='va'>X</span> <span class='op'>&lt;-</span>  <span class='fu'>MASS</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/MASS/man/mvrnorm.html'>mvrnorm</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='va'>n</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>3</span><span class='op'>)</span> , <span class='va'>Sigma</span><span class='op'>)</span>
  <span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='va'>X</span><span class='op'>)</span> <span class='op'><a href='https://rdrr.io/r/base/matmult.html'>%*%</a></span> <span class='va'>betas</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span>, <span class='fl'>0</span>, <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>Xy</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>X</span>, <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>Xy</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"w"</span>, <span class='st'>"x"</span>, <span class='st'>"z"</span><span class='op'>)</span>, <span class='st'>"y"</span><span class='op'>)</span>
  <span class='va'>fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span><span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>Xy</span><span class='op'>)</span>
  <span class='va'>sel</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/step.html'>step</a></span><span class='op'>(</span><span class='va'>fit</span>, k <span class='op'>=</span> <span class='fl'>2</span>, trace <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
  <span class='va'>s</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>sel</span><span class='op'>)</span>
  <span class='va'>tvals</span> <span class='op'>&lt;-</span> <span class='va'>s</span><span class='op'>$</span><span class='va'>coefficients</span><span class='op'>[</span>,<span class='fl'>3</span><span class='op'>]</span><span class='op'>[</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>]</span>
  <span class='va'>coefs</span><span class='op'>[</span><span class='va'>i</span>, <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>tvals</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>&lt;-</span>  <span class='va'>tvals</span>
  <span class='va'>rsq</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>s</span><span class='op'>$</span><span class='va'>r.squared</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>reps</span> <span class='op'>=</span> <span class='fl'>100</span>
<span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fl'>3</span>
<span class='va'>Sigma</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>5</span>,<span class='fl'>4</span>,<span class='fl'>5</span>,
                  <span class='fl'>4</span>,<span class='fl'>6</span>,<span class='fl'>5</span>, 
                  <span class='fl'>5</span>,<span class='fl'>5</span>,<span class='fl'>7</span><span class='op'>)</span>, <span class='va'>p</span>, <span class='va'>p</span><span class='op'>)</span>
<span class='va'>n</span> <span class='op'>=</span> <span class='fl'>200</span>
<span class='va'>betas</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span>
<span class='va'>rsq_pref</span> <span class='op'>&lt;-</span> <span class='cn'>NULL</span>
<span class='va'>coefs_pref</span> <span class='op'>&lt;-</span> <span class='va'>cover_pref</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='cn'>NA</span>, nrow <span class='op'>=</span> <span class='va'>reps</span>, ncol <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>coefs_pref</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"w"</span>, <span class='st'>"x"</span>, <span class='st'>"z"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>cover_pref</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"w"</span>, <span class='st'>"x"</span>, <span class='st'>"z"</span><span class='op'>)</span>

<span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='va'>reps</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'>#print(i)</span>
  <span class='va'>X</span> <span class='op'>&lt;-</span>  <span class='fu'>MASS</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/MASS/man/mvrnorm.html'>mvrnorm</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='va'>n</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>3</span><span class='op'>)</span> , <span class='va'>Sigma</span><span class='op'>)</span>
  <span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='va'>X</span><span class='op'>)</span> <span class='op'><a href='https://rdrr.io/r/base/matmult.html'>%*%</a></span> <span class='va'>betas</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span>, <span class='fl'>0</span>, <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>Xy</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>X</span>, <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>Xy</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"w"</span>, <span class='st'>"x"</span>, <span class='st'>"z"</span><span class='op'>)</span>, <span class='st'>"y"</span><span class='op'>)</span>
  <span class='va'>fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span><span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>Xy</span><span class='op'>)</span>
  <span class='va'>s</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span>
  <span class='va'>tvals</span> <span class='op'>&lt;-</span> <span class='va'>s</span><span class='op'>$</span><span class='va'>coefficients</span><span class='op'>[</span>,<span class='fl'>3</span><span class='op'>]</span><span class='op'>[</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>]</span>
  <span class='va'>coefs_pref</span><span class='op'>[</span><span class='va'>i</span>, <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>tvals</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>&lt;-</span>  <span class='va'>tvals</span>
  <span class='va'>rsq_pref</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>s</span><span class='op'>$</span><span class='va'>r.squared</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x_included</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='va'>coefs</span><span class='op'>[</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>coefs</span><span class='op'>[</span>,<span class='st'>"x"</span><span class='op'>]</span><span class='op'>)</span>,<span class='op'>]</span><span class='op'>)</span>
<span class='va'>x_included_pref</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='va'>coefs_pref</span><span class='op'>[</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>coefs_pref</span><span class='op'>[</span>,<span class='st'>"x"</span><span class='op'>]</span><span class='op'>)</span>,<span class='op'>]</span><span class='op'>)</span>

<span class='va'>z_included</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='va'>coefs</span><span class='op'>[</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>coefs</span><span class='op'>[</span>,<span class='st'>"z"</span><span class='op'>]</span><span class='op'>)</span>,<span class='op'>]</span><span class='op'>)</span>
<span class='va'>z_included_pref</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='va'>coefs_pref</span><span class='op'>[</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>coefs_pref</span><span class='op'>[</span>,<span class='st'>"z"</span><span class='op'>]</span><span class='op'>)</span>,<span class='op'>]</span><span class='op'>)</span>

<span class='va'>x_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind.html'>bind_rows</a></span><span class='op'>(</span><span class='st'>"select"</span><span class='op'>=</span><span class='va'>x_included</span>,<span class='st'>"pref"</span><span class='op'>=</span> <span class='va'>x_included_pref</span>,.id<span class='op'>=</span><span class='st'>"sim"</span><span class='op'>)</span>
<span class='va'>z_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind.html'>bind_rows</a></span><span class='op'>(</span><span class='st'>"select"</span><span class='op'>=</span><span class='va'>z_included</span>,<span class='st'>"pref"</span><span class='op'>=</span> <span class='va'>z_included_pref</span>,.id<span class='op'>=</span><span class='st'>"sim"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x_df</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>x</span>, color <span class='op'>=</span> <span class='va'>sim</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_density.html'>geom_density</a></span><span class='op'>(</span>adjust <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='fl'>12</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"t-values for Regressor X"</span>, y <span class='op'>=</span> <span class='st'>"Density"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="model-selection-bias_files/figure-html5/fig3-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>z_df</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>z</span>, color <span class='op'>=</span> <span class='va'>sim</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_density.html'>geom_density</a></span><span class='op'>(</span>adjust <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='fl'>12</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"t-values for Regressor Z"</span>, y <span class='op'>=</span> <span class='st'>"Density"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="model-selection-bias_files/figure-html5/fig4-1.png" width="624" /></p>
</div>
<p>These plots illustrate how post-model-selection sampling distribution
is not guaranteed to reflect the “correct” model distribution even when
it is the one selected.</p>
<h2 id="potential-solutions">Potential solutions</h2>
<p>Have two random samples from the population of interest: a training
and a test sample. It also can be done with a split-sample approach in
cases where there is one sample, although the results depends on the
sample sizes.</p>
<h1 id="lukacs-2009">Lukacs (2009)</h1>
<p>Freedman’s paradox: methods of variable selection may include
variables with no relation with the response that spuriously inflate
<span class="math inline">\(R^2\)</span>.</p>
<p>Model selection bias also occurs when there exists a weak
relationship between explanatory and response variables. The model
selection process misses this small effect often. It is more likely that
it is included when the effect is overestimated, rendering poorly
estimated parameters.</p>
<h2 id="model-averaging-vs-stepwise-selection">Model averaging vs
Stepwise selection</h2>
<p>Model selection makes inferences based on a single best model.
Variables not included are discarded from the analysis and not given
importance.</p>
<p>Model averaging makes inferences from multiple models, admitting the
uncertainty of which model is best and which variables are
important.</p>
<p>One thousand matrices of 40 rows and 21 columns were generated using
normally distributed random numbers with mean zero and variance one.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='va'>coefs</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_histogram.html'>geom_histogram</a></span><span class='op'>(</span>bins <span class='op'>=</span> <span class='fl'>30</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="model-selection-bias_files/figure-html5/unnamed-chunk-3-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Mean R squared</span>
<span class='co'>#mean(rsq)</span>
<span class='co'># Frequency of the true coefficient value captured by the 95% CI</span>
<span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colMeans</a></span><span class='op'>(</span><span class='va'>cover</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>  x1   x2   x3   x4 
0.95 0.94 0.94 0.94 </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Mean value for the coefficients</span>
<span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colMeans</a></span><span class='op'>(</span><span class='va'>coefs</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>          x1           x2           x3           x4 
-0.012543708 -0.014911180  0.005750212 -0.007467702 </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Bias for each coefficient</span>
<span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colMeans</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>coefs</span> <span class='op'>-</span> <span class='va'>beta</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>        x1         x2         x3         x4 
0.01821222 0.01862716 0.01983804 0.02031491 </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Frequency variable selection</span>
<span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colSums</a></span><span class='op'>(</span><span class='va'>tvals</span> <span class='op'>!=</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>/</span><span class='va'>reps</span>
</code></pre>
</div>
</details>
<pre><code>x1 x2 x3 x4 
 1  1  1  1 </code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Mean t-value</span>
<span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colMeans</a></span><span class='op'>(</span><span class='va'>tvals</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>       x1        x2        x3        x4 
0.3766404 0.3660867 0.3601060 0.3829058 </code></pre>
</div>
<h1 id="berk-et-al.-2013">Berk et al. (2013)</h1>
<p>The model produced by data-driven variable selection is itself
stochastic. The stochastic component of the data is involved in the
selection process. We can think, for example, of a model selected in
relation to the outcome, that is a stochastic component.</p>
<p>Once predictor variables are selected, all others are eliminated from
the analysis. This implies that the statistical inference will be
performed in a context where only the selected variables exist. We then
are restricted to an inference tied to the model selected and the
variables included.</p>
<p>With the growing number of predictors, we can expect more type I
errors. Model selection tends to favor highly significant
predictors.</p>
<p>The text adopts a view in which the the excluded predictors are
non-existent in the submodels. They’re not constrained to zero, they’re
simply not defined. The interpretation given to a predictor’s
coefficient is directly related to which other predictors are included
in the model. That is, of course, if the predictors are not orthogonal,
which implies that the coefficient value would not change across
submodels.</p>
<p>Valid statistical inference after model selection is not the same as
assuming that the selected models are correct.</p>
<p>The model <span class="math inline">\(\hat{M}\)</span> produced by
model selection is a random model. Whichever the section method used, if
the response Y is evolved, then the model is a random object because the
stochastic nature (?) of the random vector Y. The same random nature
applies to the parameter vector of coefficients. It changes randomly as
the adjuster covariates in <span class="math inline">\(\hat{M}\)</span>
vary randomly.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent"
data-line-spacing="2" role="doc-bibliography">
<div id="ref-berk2010" class="csl-entry" role="doc-biblioentry">
Berk, R. (2010). What you can and can’t properly do with regression.
<em>Journal of Quantitative Criminology</em>, <em>26</em>(4), 481–487.
<a
href="https://doi.org/10.1007/s10940-010-9116-4">https://doi.org/10.1007/s10940-010-9116-4</a>
</div>
<div id="ref-berkValidPostselectionInference2013" class="csl-entry"
role="doc-biblioentry">
Berk, R., Brown, L., Buja, A., Zhang, K., &amp; Zhao, L. (2013). Valid
post-selection inference. <em>The Annals of Statistics</em>,
<em>41</em>(2), 802–837. <a
href="https://doi.org/10.1214/12-AOS1077">https://doi.org/10.1214/12-AOS1077</a>
</div>
<div id="ref-berkStatisticalInferenceModel2010" class="csl-entry"
role="doc-biblioentry">
Berk, R., Brown, L., &amp; Zhao, L. (2010). Statistical <span>Inference
After Model Selection</span>. <em>Journal of Quantitative
Criminology</em>, <em>26</em>(2), 217–236. <a
href="https://doi.org/10.1007/s10940-009-9077-7">https://doi.org/10.1007/s10940-009-9077-7</a>
</div>
<div id="ref-cohen1983" class="csl-entry" role="doc-biblioentry">
Cohen, J., &amp; Cohen, P. (1983). <em>Applied <span>Multiple
Regression</span>/<span>Correlation Analysis</span> for the
<span>Behavioral Sciences</span></em> (2nd ed.).
</div>
<div id="ref-flora2017statistical" class="csl-entry"
role="doc-biblioentry">
Flora, D. B. (2017). <em>Statistical methods for the social and
behavioural sciences: A model-based approach</em>. SAGE Publications. <a
href="https://books.google.com.br/books?id=4mcCDgAAQBAJ">https://books.google.com.br/books?id=4mcCDgAAQBAJ</a>
</div>
</div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="references">References</h3>
<div id="references-listing"></div>
<h3 id="reuse">Reuse</h3>
<p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
